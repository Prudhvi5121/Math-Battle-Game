<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>ğŸ† Winner â€“ Math Battle Arena</title>
  <link href="https://fonts.googleapis.com/css2?family=Boogaloo&family=Nunito:wght@700;800&family=Bangers&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="/static/style.css"/>
  <style>
  body{
    margin:0;min-height:100vh;overflow-x:hidden;
    background:linear-gradient(135deg,#0d0221 0%,#190d42 50%,#2a0a4e 100%);
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    padding:20px;font-family:'Nunito',sans-serif;
  }
  canvas{position:fixed;inset:0;pointer-events:none;z-index:10;}
  .star-bg{position:fixed;inset:0;pointer-events:none;overflow:hidden;}
  .star{position:absolute;background:#fff;border-radius:50%;animation:tw var(--d,3s) var(--dl,0s) ease-in-out infinite;}
  @keyframes tw{0%,100%{opacity:.15;}50%{opacity:.8;}}

  .win-wrap{
    position:relative;z-index:20;text-align:center;
    max-width:480px;width:100%;
    background:rgba(255,255,255,.07);
    border:2px solid rgba(255,215,0,.3);
    border-radius:36px;padding:40px 28px;
    backdrop-filter:blur(12px);
    animation:bigBounce .8s cubic-bezier(.34,1.56,.64,1);
  }
  @keyframes bigBounce{from{transform:scale(.2);opacity:0;}to{transform:scale(1);opacity:1;}}

  .crown{font-size:6rem;display:block;margin-bottom:4px;animation:spin 2s linear infinite;}
  @keyframes spin{to{transform:rotate(360deg);}}
  .char-big{font-size:5rem;display:block;margin:8px 0;animation:wobble 1s ease-in-out infinite;}
  @keyframes wobble{0%,100%{transform:rotate(-8deg);}50%{transform:rotate(8deg);}}

  .win-title{
    font-family:'Bangers',cursive;
    font-size:clamp(2.5rem,10vw,4rem);
    background:linear-gradient(135deg,#ffd700,#f97316,#ec4899);
    -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
    text-shadow:none;margin:8px 0;line-height:1;
  }
  .win-sub{color:rgba(255,255,255,.6);font-weight:800;font-size:1rem;margin:6px 0;}
  .score-display{
    display:flex;gap:16px;justify-content:center;margin:20px 0;flex-wrap:wrap;
  }
  .score-box{
    border-radius:18px;padding:14px 24px;min-width:120px;text-align:center;
  }
  .score-box.blue{background:linear-gradient(135deg,#1d4ed8,#3b82f6);}
  .score-box.red {background:linear-gradient(135deg,#b91c1c,#ef4444);}
  .score-box .sn{font-size:.8rem;font-weight:800;color:rgba(255,255,255,.8);}
  .score-box .sv{font-family:'Bangers',cursive;font-size:2.2rem;color:#fff;}
  .winner-badge{
    font-size:.7rem;font-weight:800;background:#ffd700;color:#1a1a2e;
    border-radius:10px;padding:1px 8px;display:inline-block;margin-top:2px;
  }
  .stars-row{font-size:2.2rem;letter-spacing:8px;margin:12px 0;}
  .msg{
    font-family:'Boogaloo',cursive;font-size:1.3rem;
    color:#fff;margin:8px 0 20px;
  }
  .btn-row{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap;justify-content:center;}
  .btn{
    padding:16px 28px;border-radius:18px;border:none;
    font-family:'Bangers',cursive;font-size:1.2rem;letter-spacing:1px;
    color:#fff;cursor:pointer;transition:all .2s;flex:1;min-width:140px;max-width:200px;
  }
  .btn.g{background:linear-gradient(135deg,#22c55e,#15803d);box-shadow:0 6px 18px rgba(34,197,94,.4);}
  .btn.p{background:linear-gradient(135deg,#7c3aed,#a855f7);box-shadow:0 6px 18px rgba(124,58,237,.4);}
  .btn.y{background:linear-gradient(135deg,#f59e0b,#d97706);box-shadow:0 6px 18px rgba(245,158,11,.4);}
  .btn:hover{transform:translateY(-3px) scale(1.04);}
  </style>
</head>
<body>
<canvas id="conf"></canvas>
<div class="star-bg" id="sb"></div>

<div class="win-wrap">
  <span class="crown">ğŸ‘‘</span>
  <span class="char-big" id="wchar">ğŸ§™â€â™€ï¸</span>
  <h1 class="win-title" id="wtitle">TEAM BLUE WINS!</h1>
  <p class="win-sub" id="wsub">Incredible Math Battle! ğŸ”¥</p>

  <div class="score-display">
    <div class="score-box blue" id="sbox-blue">
      <div class="sn">ğŸ’™ Blue Team</div>
      <div class="sv" id="sv-blue">0</div>
    </div>
    <div class="score-box red" id="sbox-red">
      <div class="sn">â¤ï¸ Red Team</div>
      <div class="sv" id="sv-red">0</div>
    </div>
  </div>

  <div class="stars-row">â­â­â­â­â­</div>
  <p class="msg" id="wmsg">You are a math champion! ğŸ†</p>

  <div class="btn-row">
    <button class="btn g" onclick="history.back()">ğŸ”„ Play Again</button>
    <button class="btn p" onclick="location.href='/'">ğŸ  Home</button>
    <button class="btn y" onclick="showLB()">ğŸ† Leaderboard</button>
  </div>
</div>

<script>
// Read params
const p = new URLSearchParams(location.search);
const winner  = p.get("winner")  || "Team Blue";
const blueScore = parseInt(p.get("blue")  || 0);
const redScore  = parseInt(p.get("red")   || 0);
const char    = p.get("char")    || "aria";
const mode    = p.get("mode")    || "battle";
const draw    = p.get("draw")    === "1";

const CHARS = {aria:"ğŸ§™â€â™€ï¸",kai:"ğŸ¦Š",luna:"ğŸŒ¸",blaze:"ğŸ‰"};

document.getElementById("wchar").textContent   = CHARS[char] || "â­";
document.getElementById("sv-blue").textContent = blueScore;
document.getElementById("sv-red").textContent  = redScore;

if(draw){
  document.getElementById("wtitle").textContent = "IT'S A DRAW! ğŸ¤";
  document.getElementById("wsub").textContent   = "Both teams are champions!";
  document.getElementById("wmsg").textContent   = "What an epic battle! ğŸŒŸ";
} else {
  document.getElementById("wtitle").textContent = `${winner} WINS!`;
}

// Stars background
const sb = document.getElementById("sb");
for(let i=0;i<70;i++){
  const s=document.createElement("div");
  s.className="star";
  const sz=rnd(2,5);
  s.style.cssText=`width:${sz}px;height:${sz}px;left:${rnd(0,100)}%;top:${rnd(0,100)}%;--d:${rnd(2,6)}s;--dl:${rnd(0,5)}s;`;
  sb.appendChild(s);
}

// Confetti
(function confetti(){
  const canvas=document.getElementById("conf");
  canvas.width=window.innerWidth;canvas.height=window.innerHeight;
  const ctx=canvas.getContext("2d");
  const colors=["#ffd700","#f87171","#60a5fa","#4ade80","#f472b6","#a78bfa"];
  const pieces=Array.from({length:200},()=>({
    x:rnd(0,canvas.width),y:rnd(-canvas.height,0),
    r:rnd(5,12),d:rnd(2,6),
    color:colors[Math.floor(Math.random()*colors.length)],
    t:0,ti:rnd(2,8)/100,
  }));
  let f=0;
  (function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    pieces.forEach(p=>{
      p.t+=p.ti;p.y+=p.d;p.x+=Math.sin(p.t)*2;
      if(p.y>canvas.height+20){p.y=-20;p.x=rnd(0,canvas.width);}
      ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.t);
      ctx.fillStyle=p.color;ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r);
      ctx.restore();
    });
    f++;
    if(f<500) requestAnimationFrame(draw);
    else ctx.clearRect(0,0,canvas.width,canvas.height);
  })();
})();

// TTS celebration
window.addEventListener("load",()=>{
  if("speechSynthesis" in window){
    setTimeout(()=>{
      const u=new SpeechSynthesisUtterance(draw?"It's a draw! Amazing battle!":winner+" wins! Congratulations, math champion!");
      u.rate=.95;u.pitch=1.3;
      speechSynthesis.speak(u);
    },1000);
  }
});

function showLB(){location.href="/?lb=1";}
function rnd(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
</script>
</body>
</html>
